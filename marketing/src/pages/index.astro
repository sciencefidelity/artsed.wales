---
import format from "date-fns/format"
// import { cy as cym } from 'date-fns/locale'
// import { toHTML } from "@portabletext/to-html"
import { /* portableTextComponents, */ urlFor } from "../lib/utils"
import sanityClient from "../lib/sanityClient"
import { newsletterQuery } from "../lib/queries"
import PortableText from "../components/PortableText"
import { components } from "../components/PortableTextComponents"

const response = await sanityClient.fetch(newsletterQuery)
const data = response
const { cy, en } = data
const year = new Date().getFullYear()
const locale = en
---
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title set:html={locale.newsletter.title} />
  </head>
  <body>
    <table
      class="container"
      border="0"
      cellpadding="0"
      cellspacing="0"
    >
      <tr>
        <td
          valign="top"
        >
          <!-- preheader -->
          <table
            class="preheader"
            border="0"
            cellpadding="0"
            cellspacing="0"
          >
            <tr class="preheader__row">
              <td class="preheader__data">
                <a href="#" set:html={locale.labels.browser} />
              </td>
              <!-- <td class="preheader__data">
                <a href="#">Gweld yr e-bost hwn yn eich porwr</a>
              </td> -->
            </tr>
          </table>
          <!-- header -->
          <table
            class="header"
            border="0"
            cellpadding="0"
            cellspacing="0"
          >
            <tr class="header__row--brand">
              <td class="header__data--brand">
                <a href={locale.settings.url}>
                  <img
                    src={locale.newsletter.logo.url}
                    class="brand"
                    alt="National Arts and Education Network logo"
                    width="150"
                    height="150"
                  >
                </a>
              </td>
            </tr>
            <tr class="header__row">
              <td class="header__data" set:html={locale.company.title} />
            </tr>
            <tr class="header__row">
              <td class="divider"></td>
            </tr>
          </table>
          <!-- headline -->
          <table
            class="headline"
            border="0"
            cellpadding="0"
            cellspacing="0"
          >
            <tr class="headline__row">
              <td class="headline__data">
                <h1 set:html={locale.newsletter.headline} />
              </td>
            </tr>
            <tr class="headline__row--image">
              <th class="headline__data--image">
                <a href="#">
                  <img
                    src={urlFor(locale.newsletter.mainImage)
                      .auto("format")
                      .width(600)
                      .height(400)
                      .quality(80)
                      .url()}
                    class="image__fullwidth"
                    alt="Expressive arts for wellbeing (Key Stage 2)"
                    width="600"
                    height="400"
                  >
                </a>
              </th>
            </tr>
          </table>
          <!-- body -->
          <table
            class="body"
            border="0"
            cellpadding="0"
            cellspacing="0"
          >
            <tr class="body__row">
              <!-- <td
                class="body__data"
                set:html={toHTML(
                  en.newsletter.body,
                  {components: portableTextComponents}
                )}
              /> -->
              <td class="body__data">
                <PortableText
                  value={locale.newsletter.body}
                  components={components}
                  />
              </td>
            </tr>
            <tr class="header__row">
              <td class="divider"></td>
            </tr>
          </table>
          <!-- events -->
          <table
            class="events"
            border="0"
            cellpadding="0"
            cellspacing="0"
          >
            <tr class="events__row">
              <td class="events__data">
                {locale.events.map(event => (
                  <table
                    class="event"
                    border="0"
                    cellpadding="0"
                    cellspacing="0"
                  >
                    <tr class="event__row">
                      <th class="event__head">
                        <a href="#">
                          <img
                            src={urlFor(event.mainImage)
                              .auto("format")
                              .width(600)
                              .height(400)
                              .quality(80)
                              .url()}
                            class="image__inset"
                            alt="Expressive arts for wellbeing (Key Stage 2)"
                            width="300"
                            height="200"
                          >
                        </a>
                        <time datetime={
                          format(new Date(event.dateStart), "yyyy-MM-dd")
                        }>
                          {format(new Date(event.dateStart), "d MMMM yyyy, k:mm")}
                        </time>
                        <h2 set:html={event.title} />
                        <p set:html={event.summary} />
                        <p>
                          <a
                            href={event.britelink}
                            set:html={locale.labels.register}
                          />
                        </p>
                      </th>
                    </tr>
                  </table>
                ))}
              </td>
            </tr>
          </table>
          <!-- footer -->
          <table
            class="footer"
            border="0"
            cellpadding="0"
            cellspacing="0"
          >
            <tr class="footer__row--social">
              <td class="footer__data--social">
                <a href="#">
                  <img
                    src="/color-facebook-96.png"
                    class="image__social"
                    alt="Facebook"
                    width="48"
                    height="48"
                  >
                </a>
                <a href="#">
                  <img
                    src="/color-twitter-96.png"
                    class="image__social"
                    alt="Twitter"
                    width="48"
                    height="48"
                  >
                </a>
                <a href="#">
                  <img
                    src="/color-instagram-96.png"
                    class="image__social"
                    alt="Instagram"
                    width="48"
                    height="48"
                  >
                </a>
                <a href="#">
                  <img
                    src="/color-link-96.png"
                    class="image__social"
                    alt="Our website"
                    width="48"
                    height="48"
                  >
                </a>
              </td>
            </tr>
            <tr class="footer__row">
              <td class="footer__data">
                <p>&copy; {year} <span set:html={locale.company.title} /></p>
                <p>
                  <span set:html={locale.company.address.line1} /> &bull;
                  <span set:html={locale.company.address.line2} /> &bull;
                  <span set:html={locale.company.address.city} /> &bull;
                  <span set:html={locale.company.address.postcode} />
                </p>
                <p>
                  <span set:html={locale.labels.change} /><br />
                  <a href="#" set:html={locale.labels.unsubscribe} />.
                </p>
              </td>
            </tr>
          </table>
        </td>
      </tr>
    </table>
  </body>
</html>

<style global>
:root {
  --white: hsl(0, 0%, 100%);
  --lightgray: hsl(0, 0%, 98%);
  --midgray: hsl(360, 1%, 80%);
  --darkgray: hsl(0, 0%, 40%);
  --black: hsl(0, 0%, 13%);
  --blue: hsl(192, 100%, 42%);
  --background: hsl(43, 39%, 93%);
  --border: hsl(43, 39%, 83%);
  --sans: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Fira Sans","Droid Sans","Helvetica Neue",Helvetica,Arial,Verdana,sans-serif;
  --serif: ui-serif,Georgia,'Times New Roman',Times,serif;
  --mono: ui-monospace,Menlo,Courier,monospace;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  font-family: var(--sans);
}

body {
  background-color: var(--background);
  color: var(--black);
  margin: 0;
}

th,
td {
  // border: 1px dashed hsla(270, 38%, 35%, 0.6);
}

p {
  font-weight: 200;
  padding: 5px 0;
  line-height: 1.45;
}

h1 {
  font-size: 25px;
  font-weight: 500;
  line-height: 1.5;
}

h2 {
  font-size: 18px;
  font-weight: 700;
  line-height: 1.5;
}

h3 {
  font-size: 16px;
  font-weight: 400;
  line-height: 1.5;
}

time {
  display: block;
  font-size: 14px;
  font-weight: 300;
  margin: 10px 0 2px 0;
}

a {
  color: var(--blue);
  text-decoration: none;
  // font-weight: 400;
  &:hover {
    text-decoration: underline;
  }
}
</style>

<style lang="scss">
.image__fullwidth {
  width: 100%;
  height: auto;
}

.image__inset {
  width: 100%;
  height: auto;
}

.image__social {
  width: 48px;
  height: 48px;
  margin: 5px;
}

.container {
  max-width: 600px;
  width: 100%;
  margin: auto;
}

.preheader {
  width: 100%;
  text-align: center;
  padding: 20px 0;
  &__row {
    font-size: 12px;
  }
  &__data {
    width: 50%;
  }
  a {
    color: var(--darkgray);
    text-decoration: underline;
  }
}

.header {
  background-color: var(--white);
  text-transform: uppercase;
  line-height: 1.5;
  width: 100%;
  text-align: center;
  font-size: 20px;
  padding: 40px 0;
  font-weight: 200;
  letter-spacing: 0.6px;
  &__data {
    display: block;
    margin: 30px 20px 60px;
  }
  a {
    text-decoration: none;
  }
  @media only screen and (max-width: 480px) {
    font-size: 18px;
  }
}

.brand {
  border-radius: 100%;
}

.headline {
  background-color: var(--white);
  width: 100%;
  text-align: center;
  font-size: 16px;
  &__data {
    margin: 0 0 40px 0;
    display: block;
    padding: 20px;
  }
  h1 {
    @media only screen and (max-width: 480px) {
      font-size: 22px;
    }
  }
}

.body {
  background-color: var(--white);
  &__row {
    display: block;
    padding: 50px 20px;
  }
  &__data p {
    font-family: var(--sans);
    font-weight: 200;
  }
}

.divider {
  background-color: var(--background);
  height: 2px;
  // width: 94%;
  display: block;
  margin: auto;
}

.events {
  padding: 40px 0;
  background-color: var(--white);
  border-bottom: 3px solid var(--border);
}

.event {
  text-align: left;
  display: block;
  width: 50%;
  float: left;
  &__head,
  &__data {
    padding: 20px;
  }
  a {
    font-weight: 400;
  }
  @media only screen and (max-width: 480px) {
    float: none;
    width: 100%;
  }
}

.footer {
  padding: 20px 10px 40px 10px;
  width: 100%;
  text-align: center;
  color: var(--darkgray);
  p {
    font-weight: 400;
  }
  a {
    color: var(--darkgray);
    text-decoration: underline;
  }
  &__data {
    text-align: center;
    width: 100%;
    font-size: 13px;
    &--social {
      padding: 20px;
      a {
        text-decoration: none;
      }
    }
  }
}

</style>
